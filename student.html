<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>شهادة الطالب</title>
    <link href="https://fonts.googleapis.com/css2?family=Calibri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body{font-family: Calibri;}
        h1, h2 { text-align: center; }
        #student_data {
            text-align: right;
            margin-top: 20px;
        }
        .label { color: #d32f2f; font-weight: bold; }
        .value { color: #1565c0; font-weight: bold; }
    </style>
</head>
<body>
    <h1>مدارس الفلاح الأهلية</h1>
    <h2>قسم اللغة الإنجليزية</h2>
    <!-- إدخال كود الطالب -->
    <label for="code">كود الطالب:</label>
    <input type="text" id="code" placeholder="ادخل كود الطالب">
    <button onclick="loadStudentData()">عرض</button>

    <div id="student_data" style="display:none;">
        <!-- عرض بيانات الطالب -->
        <h3>بيانات الطالب:</h3>
        <p>الاسم: <span id="student_name"></span></p>
        <p>الصف: <span id="grade"></span></p>
        <p>نوع الاختبار: <span id="examType"></span></p>
        <p>الدرجة النهائية: <span id="fullMark"></span></p>
        <p>درجة الطالب: <span id="mark"></span></p>
        <p>التقدير: <span id="rating"></span></p>
        <p>المادة: <span id="subject"></span></p>
        <p>المعلم: <span id="teacher"></span></p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCX-KNQTu0Y1tnTGWd1sKtXLDUmR7Tehek",
            authDomain: "english-results.firebaseapp.com",
            projectId: "english-results",
            storageBucket: "english-results.firebasestorage.app",
            messagingSenderId: "673616902884",
            appId: "1:673616902884:web:62c38d39a3c1a0694a4af1"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function calcRating(mark, full){
            let m = Number(mark);
            let f = Number(full);
            if(!m || !f) return "—";
            let p = (m/f)*100;
            if(p>=90) return "ممتاز";
            if(p>=80) return "جيد جدًا";
            if(p>=70) return "جيد";
            if(p>=60) return "مقبول";
            return "ضعيف";
        }

        function loadStudentData() {
            let studentCode = document.getElementById('code').value.trim();
            if (!studentCode) {
                alert("يرجى إدخال كود الطالب.");
                return;
            }

            var studentRef = db.collection("students").doc(studentCode);
            
            studentRef.get().then((doc) => {
                if (doc.exists) {
                    var studentData = doc.data();

                    document.getElementById('student_data').style.display = "block";
                    document.getElementById('student_name').innerText = studentData.name;
                    document.getElementById('grade').innerText = studentData.grade;
                    document.getElementById('examType').innerText = studentData.examType;
                    document.getElementById('fullMark').innerText = studentData.fullMark;
                    document.getElementById('mark').innerText = studentData.mark;
                    document.getElementById('subject').innerText = studentData.subject;
                    document.getElementById('teacher').innerText = studentData.teacher;

                    // حساب التقدير
                    document.getElementById('rating').innerText = calcRating(studentData.mark, studentData.fullMark);
                } else {
                    alert("الطالب غير موجود.");
                }
            }).catch((error) => {
                console.error("Error getting document: ", error);
            });
        }
    </script>

</body>
</html>
