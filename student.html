<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>شهادة الطالب - مدارس الفلاح الأهلية</title>
<link href='https://fonts.googleapis.com/css2?family=Calibri:wght@400;700&display=swap' rel='stylesheet'>

<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

<style>
body{font-family:Calibri;background:#f6f6f6;margin:0;padding:25px}
h1{text-align:center;color:#1565c0;font-size:30px;margin-bottom:5px}
h2{text-align:center;color:#d32f2f;font-size:22px;margin-top:0}
table{width:100%;border-collapse:collapse;margin-top:20px;font-size:18px}
td,th{border:1px solid #000;padding:8px;text-align:center}
th{background:#1976d2;color:white}
.total{background:#fff59d;font-weight:bold}
.btn{width:100%;padding:15px;border:none;border-radius:8px;font-size:18px;margin-bottom:10px;cursor:pointer}
.view{background:#1976d2;color:white}
.print{background:#388e3c;color:white}
.back{background:#777;color:white}
@media print{.btn,#code{display:none}}
.footer{text-align:center;margin-top:30px;font-weight:bold;color:#999}
</style>
</head>
<body>

<input id="code" placeholder="ادخل كود الطالب" class="btn" style="border:1px solid #999">
<button onclick="loadData()" class="btn view">عرض النتيجة</button>
<button onclick="window.print()" class="btn print">طباعة</button>
<button onclick="location='index.html'" class="btn back">الصفحة الرئيسية</button>

<h1>مدارس الفلاح الأهلية</h1>
<h2>شهادة درجات الطالب</h2>

<div id="cert" style="display:none">
  <table>
    <tr><th>اسم الطالب</th><td id="st_name"></td></tr>
    <tr><th>الصف</th><td id="st_grade"></td></tr>
    <tr><th>الشعبة</th><td id="st_section"></td></tr>
  </table>

  <table id="sub_table">
    <thead>
      <tr><th>المادة</th><th>الدرجة النهائية</th><th>درجة الطالب</th><th>التقدير</th></tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr class="total"><td>المجموع الكلي</td><td id="full_total"></td><td id="mark_total"></td><td id="rating_total"></td></tr>
    </tfoot>
  </table>

  <div class="footer">تصميم محمد عامر أحمد</div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC4-cGVb2pHwo6LYiD-UoWtmEEZKQxj4_M",
  authDomain: "all-subjects-14322.firebaseapp.com",
  projectId: "all-subjects-14322",
  storageBucket: "all-subjects-14322.firebasestorage.app",
  messagingSenderId: "813955287168",
  appId: "1:813955287168:web:07efa7dde95b117b9bbe65"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

function calcRating(mark,full){
  if(!mark||!full) return "—";
  const p=(mark/full)*100;
  if(p>=90) return "ممتاز";
  if(p>=80) return "جيد جدًا";
  if(p>=70) return "جيد";
  if(p>=60) return "مقبول";
  return "ضعيف";
}

async function loadData(){
  const c=document.getElementById("code").value.trim();
  if(!c){alert("ادخل كود الطالب");return;}
  const doc=await db.collection("students").doc(c).get();
  if(!doc.exists){alert("الكود غير موجود");return;}
  const st=doc.data();
  document.getElementById("cert").style.display="block";
  document.getElementById("st_name").innerText=st.name;
  document.getElementById("st_grade").innerText=st.grade;
  document.getElementById("st_section").innerText=st.section;
  const tbody=document.querySelector("#sub_table tbody");
  tbody.innerHTML="";
  let totalFull=0,totalMark=0;
  st.subjects.forEach(s=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${s.name}</td><td>${s.fullMark}</td><td>${s.mark}</td><td>${calcRating(s.mark,s.fullMark)}</td>`;
    tbody.appendChild(tr);
    totalFull+=s.fullMark||0;
    totalMark+=s.mark||0;
  });
  document.getElementById("full_total").innerText=totalFull;
  document.getElementById("mark_total").innerText=totalMark;
  document.getElementById("rating_total").innerText=calcRating(totalMark,totalFull);
}
</script>

</body>
</html>
