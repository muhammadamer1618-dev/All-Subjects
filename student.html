<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>شهادة الطالب - مدارس الفلاح الأهلية</title>
<link href='https://fonts.googleapis.com/css2?family=Calibri:wght@400;700&display=swap' rel='stylesheet'>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

<style>
body{font-family:Calibri;background:#f6f6f6;margin:0;padding:25px}
table{width:100%;border-collapse:collapse;margin-top:20px;font-size:20px}
td,th{border:1px solid #000;padding:10px;text-align:center}
th{background:#1976d2;color:#fff}
.btn{width:100%;padding:15px;border:none;border-radius:8px;font-size:18px;margin-bottom:10px;cursor:pointer}
.view{background:#1976d2;color:white}
.print{background:#388e3c;color:white}
.back{background:#777;color:white}
@media print{.btn,#code{display:none}}
</style>
</head>
<body>

<input id="code" placeholder="ادخل كود الطالب" class="btn" style="border:1px solid #999">
<button onclick="loadData()" class="btn view">عرض</button>
<button onclick="window.print()" class="btn print">طباعة</button>
<button onclick="location='index.html'" class="btn back">الصفحة الرئيسية</button>

<div id="cert" style="display:none">
<h1 style="text-align:center;color:#1565c0;font-size:34px;margin:0;font-weight:bold;">مدارس الفلاح الأهلية</h1>
<h2 style="text-align:center;color:#d32f2f;font-size:26px;margin-top:5px;font-weight:bold;">كشف الدرجات</h2>

<table>
<tr><td>اسم الطالب</td><td id="st_name"></td></tr>
<tr><td>الصف</td><td id="st_grade"></td></tr>
<tr><td>الشعبة</td><td id="st_section"></td></tr>
</table>

<table id="subjectsTable">
<thead>
<tr>
<th>المادة</th>
<th>نوع الاختبار</th>
<th>الدرجة النهائية</th>
<th>درجة الطالب</th>
<th>التقدير</th>
<th>اسم المعلم</th>
<th>مشرف المادة</th>
</tr>
</thead>
<tbody></tbody>
</table>

<table style="margin-top:25px">
<tr>
<td>رئيس قسم الإشراف</td>
<td>مدير المدرسة</td>
</tr>
<tr>
<td>أحمد سمير عباس</td>
<td>سعيد بن علي الجمعان</td>
</tr>
</table>
</div>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyC4-cGVb2pHwo6LYiD-UoWtmEEZKQxj4_M",
  authDomain: "all-subjects-14322.firebaseapp.com",
  projectId: "all-subjects-14322",
  storageBucket: "all-subjects-14322.firebasestorage.app",
  messagingSenderId: "813955287168",
  appId: "1:813955287168:web:07efa7dde95b117b9bbe65"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.firestore();

async function loadData(){
  let code=document.getElementById("code").value.trim();
  if(!code){alert("ادخل كود الطالب");return;}

  try{
    let doc=await db.collection("students").doc(code).get();
    if(!doc.exists){alert("الكود غير موجود");return;}
    let st=doc.data();

    document.getElementById("cert").style.display="block";
    document.getElementById("st_name").innerText=st.name||"";
    document.getElementById("st_grade").innerText=st.grade||"";
    document.getElementById("st_section").innerText=st.section||"";

    let tbody=document.querySelector("#subjectsTable tbody");
    tbody.innerHTML="";
    let totalMarks=0,totalFull=0;

    for(let sub in st.subjects){
      let s=st.subjects[sub];
      let tr=document.createElement("tr");
      tr.innerHTML=`
      <td>${sub}</td>
      <td>${s.exam||""}</td>
      <td>${s.fullMark||""}</td>
      <td>${s.mark||""}</td>
      <td>${s.rating||""}</td>
      <td>${s.teacher||""}</td>
      <td>${s.supervisor||""}</td>`;
      tbody.appendChild(tr);
      totalMarks+=Number(s.mark||0);
      totalFull+=Number(s.fullMark||0);
    }
  }catch(e){alert("خطأ في تحميل البيانات");console.log(e);}
}
</script>
</body>
</html>
